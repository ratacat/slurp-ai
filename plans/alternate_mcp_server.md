# Plan: Alternate MCP Server using mcp-framework

**Goal:** Create an alternative Model Context Protocol (MCP) server for the Slurp project using the `mcp-framework` package, aiming to replicate the functionality outlined in the original plan (`plans/mcp_server_integration.md`) while leveraging the framework's structure and tooling. This serves as an alternative approach to the server implemented in `mcp-server.js` which uses the base `@modelcontextprotocol/sdk`.

**Framework:** `mcp-framework` (https://www.npmjs.com/package/mcp-framework)

**Key Differences from Original Plan:**

*   Utilizes `mcp-framework` instead of `@modelcontextprotocol/sdk`.
*   Leverages the framework's CLI for project setup and component generation.
*   Relies on the framework's conventions for tool/resource definition and discovery (likely directory-based).

**Implementation Plan (Potentially fewer explicit steps due to framework automation):**

1.  **Setup `mcp-framework` Project:**
    *   **Objective:** Initialize a new MCP server project using the `mcp-framework` CLI.
    *   **Actions:**
        *   Install the `mcp-framework` CLI tool (likely globally: `npm install -g mcp-framework` or similar, verify exact command).
        *   Create a dedicated directory for this server implementation (e.g., `mcp-framework-server/`) to avoid conflicts.
        *   Inside the new directory, use the framework's CLI to create a new project (e.g., `mcp-cli create slurp-server --transport stdio`). Verify the exact command.
        *   Install local project dependencies (`npm install`).
    *   **New Files:** Project structure generated by `mcp-framework` CLI within the `mcp-framework-server/` directory.

2.  **Integrate Core Slurp Logic:**
    *   **Objective:** Ensure the core `slurpWorkflow` function is accessible to the new server.
    *   **Actions:**
        *   Confirm that the refactored `src/slurpWorkflow.js` (from the original plan) exists and is callable.
        *   Adjust imports or paths if necessary, potentially copying or linking the workflow logic into the new server's structure if required by the framework.

3.  **Implement `slurp_url` Tool:**
    *   **Objective:** Define the `slurp_url` tool using `mcp-framework` conventions.
    *   **Actions:**
        *   Use the framework's CLI to add a tool (e.g., `mcp-cli add tool slurp_url`).
        *   Locate the generated tool file (likely within a `src/tools/` directory).
        *   Define the input schema (`{ url: string }`) according to the framework's method (e.g., using Zod schemas within the generated file, decorators, etc.).
        *   Implement the tool's handler logic:
            *   Call the `slurpWorkflow` function.
            *   Handle success: Format the result path into a `slurp://` URI and return it as expected by the framework.
            *   Handle errors: Convert workflow errors into appropriate MCP errors as expected by the framework.
    *   **Files to Modify:** Tool file generated by the CLI (e.g., `mcp-framework-server/src/tools/slurp_url.ts`).

4.  **Implement `slurp://` Resource Handling:**
    *   **Objective:** Define a resource handler for the `slurp://` scheme using `mcp-framework`.
    *   **Actions:**
        *   Use the framework's CLI to add a resource (e.g., `mcp-cli add resource slurp_docs`). The naming might influence the URI matching.
        *   Locate the generated resource file (likely within `src/resources/`).
        *   Define how this resource matches the `slurp://{+path}` pattern using the framework's mechanisms (this might involve naming conventions, configuration, or specific code within the resource file).
        *   Implement the resource reading logic:
            *   Extract the relative path from the incoming request/URI.
            *   Resolve the absolute path securely.
            *   Read the file content using `fs.readFile`.
            *   Return the content according to the framework's resource result structure (e.g., `{ contents: [{ text: fileContent, mimeType: 'text/markdown' }] }`).
            *   Handle file-not-found and other errors appropriately for the framework.
    *   **Files to Modify:** Resource file generated by the CLI (e.g., `mcp-framework-server/src/resources/slurp_docs.ts`).

5.  **Testing and Refinement:**
    *   **Objective:** Verify the functionality of the `mcp-framework`-based server.
    *   **Actions:**
        *   Build the TypeScript project (`npm run build`).
        *   Run the server (e.g., `npm start` or `node build/index.js`).
        *   Use `mcptools` to test:
            *   **Test `slurp_url`:** `mcp call slurp_url --params '{"url": "..."}' node mcp-framework-server/build/index.js`. Verify a `slurp://` URI is returned.
            *   **Test Resource Reading (Crucial):** Attempt to read the resource using `mcp read-resource <returned_uri> node mcp-framework-server/build/index.js`. **Determine if `mcp-framework` correctly handles the positional argument from `mcp read-resource` over stdio.**
            *   **Test Resource Reading (Alternative):** If `mcp read-resource` fails, test reading via `mcp call <resource_name_or_uri> ...` if the framework supports this.
            *   Test error handling (invalid URL, non-existent resource URI).
        *   Refine implementation based on test results and framework documentation.